document.addEventListener("DOMContentLoaded",(function(){const{S3:t}=AWS,e=new t({accessKeyId:"4b68780a4be74f31aa2e7cbc4de6dd2f",secretAccessKey:"92dcce9fa2034ac7af8fd4c92182567e",endpoint:"https://projects.pawsey.org.au",s3ForcePathStyle:!0,region:"us-east-1"});function a(t,e){const a=t.split("\n").filter((t=>""!==t.trim())),o=a[0].split(e).map((t=>t.trim()));return a.slice(1).map((t=>{const a=t.split(e).map((t=>t.trim()));let n={};return o.forEach(((t,e)=>{void 0!==a[e]&&(n[t]=a[e])})),n}))}let o=null;fetch("static/data/points.csv").then((t=>t.text())).then((t=>{const n=function(t){const n=L.layerGroup();return t.forEach((t=>{const r=t.Points,s=parseFloat(t.latitude),i=parseFloat(t.longitude);if(isNaN(s)||isNaN(i))console.warn("Invalid latitude or longitude for point:",t);else{const t=L.marker([s,i]).bindTooltip(`<b>Point No: ${r}</b><br>Latitude: ${s}<br>Longitude: ${i}`,{permanent:!1,direction:"top"}).on("click",(()=>{!async function(t){const n=[`csiem-data/data-lake/NASA/GHRSST/Points/2002-2023/GHRSST_sst_point_${t}.csv`,`csiem-data/data-lake/NASA/GHRSST/Points/ghrsst_sst_point_${t}.csv`],r=(await Promise.all(n.map((t=>async function(t){try{const a={Bucket:"wamsi-westport-project-1-1",Key:t};return(await e.getObject(a).promise()).Body.toString("utf-8")}catch(t){return console.error("Error fetching object from S3:",t),null}}(t))))).filter(Boolean).flatMap((t=>a(t,",")));r.length>0&&function(t,e){const a=t.map((t=>new Date(t.time))),n=t.map((t=>parseFloat(t.analysed_sst))),r=document.getElementById("chart").getContext("2d");o&&o.destroy(),document.getElementById("chart-container").style.display="block",o=new Chart(r,{type:"line",data:{labels:a,datasets:[{label:`GHRSST SST at Station ${e}`,data:n,borderColor:"rgba(255, 0, 0, 1)",borderWidth:1,fill:!1,pointRadius:0}]},options:{responsive:!0,scales:{x:{type:"time",time:{unit:"day",tooltipFormat:"yyyy-MM-dd",displayFormats:{day:"yyyy-MM-dd"}},title:{display:!0,text:"Time"}},y:{title:{display:!0,text:"Sea Surface Temperature [deg C]"}}}}})}(r,t)}(r)}));n.addLayer(t)}})),layerControl.addOverlay(n,"GHRSST SST"),n}(a(t,","));map.on("overlayremove",(function(t){t.layer===n&&(document.getElementById("chart-container").style.display="none",o&&(o.destroy(),o=null))}))})).catch((t=>console.error("Error fetching CSV data:",t)))}));